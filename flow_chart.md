# クライアント・サーバ間ファイルアップロードプロセスのフロー

| 順番 | クライアント側の処理                                          | サーバ側の処理                                              |
| :--- | :------------------------------------------------------------ | :---------------------------------------------------------- |
| 1    | **開始**<br>CLI で起動                                        | **開始**<br>CLI で起動・バックグラウンド待機                |
| 2    | mp4 ファイルを選択                                            | 接続要求待機                                                |
| 3    | ファイルサイズを取得                                          | 接続要求を受理                                              |
| 4    | TCP 接続を確立                                                | ※クライアントからの接続を受け入れる                         |
| 5    | 32 バイトでファイルサイズを送信                               | 32 バイトでファイルサイズを受信                             |
| 6    | 1400 バイトずつに分割してファイルデータ送信開始（ループ開始） | 受信ファイル用バッファを初期化                              |
| 7    | ループ処理：1400 バイトずつデータを送信                       | ループ処理：1400 バイトずつデータを受信                     |
| 8    | **全データ送信完了？**<br>（送信完了なら次へ）                | 受信データサイズがファイルサイズと一致するか確認            |
| 9    | 16 バイトのレスポンスを待機                                   | 一致していれば、mp4 ファイルとして保存                      |
| 10   | 16 バイトのレスポンスを受信し、結果を表示                     | 16 バイトのステータスレスポンスを生成し、クライアントへ送信 |
| 11   | **終了**                                                      | 終了または次の接続要求を待機                                |

> ※注意: ループ処理部分は、データが全て送受信されるまで繰り返されます。
